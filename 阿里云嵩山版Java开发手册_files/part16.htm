<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>(一) 错误码</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part15.htm">&lt; 上一个</a><span> | </span><a href="../阿里云嵩山版Java开发手册.html">内容</a><span> | </span><a href="part17.htm">下一个 &gt;</a></p><p class="s65" style="padding-top: 12pt;padding-left: 6pt;text-indent: 0pt;text-align: left;"><a name="bookmark27">(一) </a><span class="s16">错误码</span><a name="bookmark31">&zwnj;</a></p><p class="s25" style="padding-top: 16pt;padding-left: 24pt;text-indent: 0pt;text-align: justify;">1. <span style=" color: #C00000;">【强制】</span>错误码的制定原则：快速溯源、沟通标准化。</p><p class="s27" style="padding-left: 42pt;text-indent: 0pt;line-height: 110%;text-align: justify;">说明： <span style=" color: #23292D;">错误码想得过于完美和复杂，就像康熙字典中的生僻字一样，用词似乎精准，但是字典不容易随身携带并且简单易懂。</span></p><p class="s24" style="padding-left: 42pt;text-indent: 0pt;line-height: 109%;text-align: justify;">正例：<span style=" color: #23292D;">错误码回答的问题是谁的错？错在哪？1）错误码必须能够快速知晓错误来源，可快速判断是谁的问题。2）错误码必须能够进行清晰地比对（代码中容易equals）。3）错误码有利于团队快速对错误原因达到一致认知。</span></p><p class="s25" style="padding-top: 10pt;padding-left: 24pt;text-indent: 0pt;text-align: justify;">2. <span style=" color: #C00000;">【强制】</span>错误码不体现版本号和错误等级信息。</p><p class="s27" style="padding-left: 42pt;text-indent: 0pt;text-align: left;">说明：<span style=" color: #23292D;">错误码以不断追加的方式进行兼容。错误等级由日志和错误码本身的释义来决定。</span></p><p class="s25" style="padding-top: 12pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">3. <span style=" color: #C00000;">【强制】</span>全部正常，但不得不填充错误码时返回五个零：00000。</p><p class="s25" style="padding-top: 11pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">4. <span style=" color: #C00000;">【强制】</span>错误码为字符串类型，共 5 位，分成两个部分：错误产生来源+四位数字编号。</p><p class="s27" style="padding-left: 42pt;text-indent: 0pt;line-height: 109%;text-align: left;">说明：<a href="part33.htm#bookmark63" style=" color: #23292D; font-family:微软雅黑, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10.5pt;">错误产生来源分为 A/B/C，A 表示错误来源于用户，比如参数错误，用户安装版本过低，用户支付超时等问题；B 表示错误来源于当前系统，往往是业务逻辑出错，或程序健壮性差等问题；C 表示错误来源于第三方服务，比如 CDN 服务出错，消息投递超时等问题；四位数字编号从 0001 到 9999，大类之间的步长间距预留 100，参考文末</a><a href="part33.htm#bookmark63" class="s63">附表 </a><span style=" color: #00F; font-family:微软雅黑, sans-serif; font-style: normal; font-weight: bold; text-decoration: underline; font-size: 10.5pt;">3</span><span style=" color: #23292D;">。</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s25" style="padding-top: 2pt;padding-left: 42pt;text-indent: -18pt;text-align: left;">5. <span style=" color: #C00000;">【强制】</span>编号不与公司业务架构，更不与组织架构挂钩，以先到先得的原则在统一平台上进行，审批生效，编号即被永久固定。</p><p class="s25" style="padding-top: 11pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">6. <span style=" color: #C00000;">【强制】</span>错误码使用者避免随意定义新的错误码。</p><p class="s27" style="padding-left: 42pt;text-indent: 0pt;text-align: left;">说明：<span style=" color: #23292D;">尽可能在原有错误码附表中找到语义相同或者相近的错误码在代码中使用即可。</span></p><p class="s25" style="padding-top: 12pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">7. <span style=" color: #C00000;">【强制】</span>错误码不能直接输出给用户作为提示信息使用。</p><p class="s27" style="padding-left: 42pt;text-indent: 0pt;line-height: 109%;text-align: left;">说明：<span style=" color: #23292D;">堆栈（stack_trace）、错误信息(error_message)、错误码（error_code）、提示信息（user_tip）是一个有效关联并互相转义的和谐整体，但是请勿互相越俎代庖。</span></p><p class="s25" style="padding-top: 11pt;padding-left: 42pt;text-indent: -18pt;text-align: left;">8. <span style=" color: #FFC000;">【推荐】</span>错误码之外的业务独特信息由 error_message 来承载，而不是让错误码本身涵盖过多具体业务属性。</p><p class="s25" style="padding-top: 11pt;padding-left: 42pt;text-indent: -18pt;text-align: left;">9. <span style=" color: #FFC000;">【推荐】</span>在获取第三方服务错误码时，向上抛出允许本系统转义，由 C 转为 B，并且在错误信息上带上原有的第三方错误码。</p><p class="s25" style="padding-top: 11pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">10. <span style=" color: #76923B;">【参考】</span>错误码分为一级宏观错误码、二级宏观错误码、三级宏观错误码。</p><p class="s27" style="padding-left: 42pt;text-indent: 0pt;text-align: left;">说明：<span style=" color: #23292D;">在无法更加具体确定的错误场景中，可以直接使用一级宏观错误码，分别是：A0001（用户端错误）、</span></p><p class="s26" style="padding-top: 4pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">B0001（系统执行出错）、C0001（调用第三方服务出错）。</p><p class="s24" style="padding-top: 1pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">正例：<span style=" color: #23292D;">调用第三方服务出错是一级，中间件错误是二级，消息服务出错是三级。</span></p><p class="s25" style="padding-top: 12pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">11. <span style=" color: #76923B;">【参考】</span>错误码的后三位编号与 HTTP 状态码没有任何关系。</p><p class="s25" style="padding-top: 11pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">12. <span style=" color: #76923B;">【参考】</span>错误码有利于不同文化背景的开发者进行交流与代码协作。</p><p class="s27" style="padding-left: 42pt;text-indent: 0pt;line-height: 110%;text-align: left;">说明：<span style=" color: #23292D;">英文单词形式的错误码不利于非英语母语国家（如阿拉伯语、希伯来语、俄罗斯语等）之间的开发者互相协作。</span></p><p class="s25" style="padding-top: 11pt;padding-left: 42pt;text-indent: -18pt;text-align: left;">13. <span style=" color: #76923B;">【参考】</span>错误码即人性，感性认知+口口相传，使用纯数字来进行错误码编排不利于感性记忆和分类。</p><p class="s27" style="padding-left: 42pt;text-indent: 0pt;text-align: left;">说明：<span style=" color: #23292D;">数字是一个整体，每位数字的地位和含义是相同的。</span></p><p class="s18" style="padding-top: 1pt;padding-left: 42pt;text-indent: 0pt;line-height: 110%;text-align: left;">反例：<span style=" color: #23292D;">一个五位数字 12345，第 1 位是错误等级，第 2 位是错误来源，345 是编号，人的大脑不会主动地拆开并分辨每位数字的不同含义。</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part15.htm">&lt; 上一个</a><span> | </span><a href="../阿里云嵩山版Java开发手册.html">内容</a><span> | </span><a href="part17.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
