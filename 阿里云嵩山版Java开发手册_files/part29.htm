<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>(三) 服务器</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part28.htm">&lt; 上一个</a><span> | </span><a href="../阿里云嵩山版Java开发手册.html">内容</a><span> | </span><a href="part30.htm">下一个 &gt;</a></p><p class="s16" style="padding-left: 6pt;text-indent: 0pt;text-align: left;"><a name="bookmark51">(三) 服务器</a><a name="bookmark55">&zwnj;</a></p><p class="s9" style="padding-top: 8pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">1. <span style=" color: #FFC000;">【推荐】</span>高并发服务器建议调小 <span class="s12">TCP </span>协议的 <span class="s12">time</span>_<span class="s12">wait </span>超时时间。</p><p class="s27" style="padding-left: 42pt;text-indent: 0pt;line-height: 109%;text-align: justify;">说明：<span style=" color: #333;">操作系统默认 240 秒后，才会关闭处于 time_wait 状态的连接，在高并发访问下，服务器端会因为处于 time_wait 的连接数太多，可能无法建立新的连接，所以需要在服务器上调小此等待值。</span></p><p class="s24" style="padding-top: 4pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">正例：<span style=" color: #333;">在 linux 服务器上请通过变更/etc/sysctl.conf 文件去修改该缺省值（秒）：</span></p><p style="padding-top: 1pt;padding-left: 68pt;text-indent: 0pt;text-align: left;">net.ipv4.tcp_fin_timeout = 30</p><p class="s9" style="padding-top: 3pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">2. <span style=" color: #FFC000;">【推荐】</span>调大服务器所支持的最大文件句柄数<span class="s12">（File Descriptor</span>，简写为 <span class="s12">fd）</span>。</p><p class="s27" style="padding-left: 42pt;text-indent: 0pt;line-height: 109%;text-align: left;">说明：<span style=" color: #333;">主流操作系统的设计是将 TCP/UDP 连接采用与文件一样的方式去管理，即一个连接对应于一个 fd。主流的linux 服务器默认所支持最大fd 数量为1024，当并发连接数很大时很容易因为fd 不足而出现“open too many files”错误，导致新的连接无法建立。建议将 linux 服务器所支持的最大句柄数调高数倍（与服务器的内存数量相关）。</span></p><p class="s25" style="padding-left: 24pt;text-indent: 0pt;line-height: 20pt;text-align: left;"><span style=" color: #333;">3. </span><span style=" color: #FFC000;">【推荐】</span>给 <span class="s51">JVM </span>环境参数设置<span class="s51">-XX:+HeapDumpOnOutOfMemoryError </span>参数，让 <span class="s51">JVM </span>碰到 <span class="s51">OOM</span></p><p class="s25" style="padding-left: 42pt;text-indent: 0pt;line-height: 22pt;text-align: justify;">场景时输出 <span class="s51">dump </span>信息。</p><p class="s27" style="padding-left: 42pt;text-indent: 0pt;text-align: justify;">说明：<span class="s53">OOM </span><span style=" color: #23292D;">的发生是有概率的，甚至相隔数月才出现一例，出错时的堆内信息对解决问题非常有帮助。</span></p><p class="s9" style="padding-top: 8pt;padding-left: 42pt;text-indent: -18pt;text-align: justify;">4. <span style=" color: #FFC000;">【推荐】</span>在线上生产环境，<span class="s12">JVM </span>的 <span class="s12">Xms </span>和 <span class="s12">Xmx </span>设置一样大小的内存容量，避免在 <span class="s12">GC </span>后调整堆大小带来的压力。</p><p class="s9" style="padding-top: 7pt;padding-left: 42pt;text-indent: -18pt;text-align: justify;">5. <span style=" color: #76923B;">【参考】</span>服务器内部重定向必须使用 <span class="s12">forward；</span>外部重定向地址必须使用 <span class="s12">URL </span>Broker 生成，否则因线上采用 HTTPS 协议而导致浏览器提示“不安全“。此外，还会带来 <span class="s12">URL </span>维护不一致的问题。</p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part28.htm">&lt; 上一个</a><span> | </span><a href="../阿里云嵩山版Java开发手册.html">内容</a><span> | </span><a href="part30.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
